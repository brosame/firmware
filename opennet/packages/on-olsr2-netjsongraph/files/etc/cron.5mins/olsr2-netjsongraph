#!/bin/sh

set -eu

. "${IPKG_INSTROOT:-}/usr/lib/opennet/on-helper.sh"

tmpfile=$(mktemp)
trap "rm -f '$tmpfile'" EXIT

echo /netjsoninfo graph \
	| nc localhost 2009 \
	| shorten_ipv6_address_in_stream \
	| replace_ipv6_addresses_with_names "id_" \
	| replace_ipv6_addresses_with_names '"label":"' \
	>"$tmpfile"
chmod 644 "$tmpfile"
mv "$tmpfile" /tmp/olsr2.json
