#!/bin/sh
#
# Dieses Skript enthaelt Funktionen, die bekannte openwrt-Probleme beheben.
# Alle Funktionen muessen idempotent sein.
#
# Dieses Skript wird nur ein einziges Mal nach einem Upgrade oder der Erstinstallation ausgefuehrt:
#   http://wiki.openwrt.org/doc/uci#defaults
#


# lieber strikte Fehlerpruefungen - wir wollen nix kaputtmachen, wenn es nicht den Erwartungen entspricht
set -eu

. "${IPKG_INSTROOT:-}/usr/lib/opennet/on-helper.sh"


# Die openwrt-Basisversion fuer v0.5.0 sorgt leider nicht dafuer, dass die Datei /etc/shadow bei einem Upgrade erhalten bleibt.
# Das Problem ist inzwischen in openwrt behoben.
# Beim naechsten Release mit einer neuen openwrt-Basis koennen wir diese Einstellung via migrations wieder entfernen.
# siehe https://dev.openwrt.org/ticket/18206
keep_shadow_file() {
	uci set "luci.flash_keep.on_core_keep_shadow=/etc/shadow"
	uci commit luci
}


keep_shadow_file

