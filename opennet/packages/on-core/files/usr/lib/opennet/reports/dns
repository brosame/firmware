#!/bin/sh
#
# Ueberblick ueber die DNS-Funktionalitaet
#

set -eu


# uci-basierte Konfiguration extrahieren
uci show dhcp | grep "^dhcp\.@dnsmasq" >dns.uci


# kopiere Config-Dateien (keine dhcp-leases)
for fname in /etc/resolv.conf /tmp/resolv.conf.auto /var/etc/dnsmasq.conf /var/run/dnsmasq.servers; do
	[ -e "$fname" ] && cp "$fname" "$(basename "$fname")" || true
done


# mehrere Namensabfragen durchfuehren
(
	nslookup localhost || true
	echo
	nslookup ca.on || true
	echo
	nslookup ca.opennet-initiative.de || true
	echo
	nslookup fsf.org || true
) >dns_tests.log 2>&1

