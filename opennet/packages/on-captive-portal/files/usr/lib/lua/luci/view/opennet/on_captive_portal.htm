<%#
Opennet Firmware

Copyright 2015 Lars Kruse <devel@sumpfralle.de>

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

	http://www.apache.org/licenses/LICENSE-2.0

-%>

<%
	require("luci.model.opennet.funcs")
%>
<%+header%>

<h2><a id="content" name="content"><%:Public Hotspot%></a></h2>
<%= html_display_error_list(on_errors) %>

<form method="post" action="<%=REQUEST_URI%>" enctype="multipart/form-data">
<div class="cbi-map">
<div class="cbi-map-descr">
	<p><%:You may want to run a public hotspot in your area.%></p>
	<p><%:This requires a working VPN connection:%>
		<a href="<%= on_url("mig_openvpn") %>"><%:VPN Tunnel%></a></p>
	<p><%:Disable the Hotspot feature by removing the physical device from the 'free' network interface.%></p>
	<p><%:Users do not need to authenticate themselves. Basic information about using a public Opennet hotspot is presented during the first http connection attempt.%></p>
</div>

<%# hotspot settings %>
<fieldset class="cbi-section">
	<legend><%:Hotspot Settings%></legend>
	<div class="cbi-section-descr">
		<p><%:The hotspot name describes the location of this hotspot (informal).%></p>
		<p><%:The redirection URL is delivered by an HTTP Redirect (307) during the first HTTP connection attempt of a client.%></p>
	</div>
	<div class="cbi-section-node">
		<div class="cbi-value">
			<label class="cbi-value-title" for="name"><%:Hotspot Name%>:</label>
			<div class="cbi-value-field">
				<input type="text" class="cbi-input-text" size="20"
					name="captive_portal_node_name" value="<%=luci.util.pcdata(portal_name)%>" />
			</div>
		</div>
		<div class="cbi-value">
			<label class="cbi-value-title" for="name"><%:Redirection URL%>:</label>
			<div class="cbi-value-field">
				<input type="text" class="cbi-input-text" size="50"
					name="captive_portal_url" value="<%=luci.util.pcdata(portal_url)%>" />
			</div>
		</div>
	</div>
</fieldset>

<%# list of hotspot clients %>
<fieldset class="cbi-section">
	<legend><%:Hotspot Clients%></legend>
	<div class="cbi-section-descr">
		<%:The hotspot client list is only available locally.%>
	</div>
	<table class="cbi-section-table">
		<tr class="cbi-section-table-titles">
			<th><%:Number%></th>
			<th><%:Local IP Address%></th>
			<th><%:Client MAC Address%></th>
			<th><%:Connected since%></th>
			<th><%:Last activity%></th>
			<th><%:Download (MB)%></th>
			<th><%:Upload (MB)%></th>
		</tr>
		<% for index, client_info in ipairs(line_split(on_function("get_captive_portal_clients"))) do %>
		<tr class="cbi-section-table-row">
			<td class="cbi-value-field"><%=index%></td>
			<% local details = tab_split(client_info) %>
			<%# IP-Adresse %>
			<td class="cbi-value-field"><%= details[1] %></td>
			<%# MAC-Adresse %>
			<td class="cbi-value-field"><%= details[2] %></td>
			<%# Verbindungsbeginn %>
			<td class="cbi-value-field"><%= luci.util.pcdata(get_timestamp_age_string(tonumber(details[3]))) %></td>
			<%# letzte AktivitÃ¤t %>
			<td class="cbi-value-field"><%= luci.util.pcdata(get_timestamp_age_string(tonumber(details[4]))) %></td>
			<%# Download %>
			<td class="cbi-value-field"><%= math.floor(details[5] / 1000) %></td>
			<%# Upload %>
			<td class="cbi-value-field"><%= math.floor(details[6] / 1000) %></td>
		</tr>
		<% end %>
	</table>
</fieldset>

</div>
<div class="cbi-page-actions">
	<input class="cbi-button cbi-button-save" type="submit" name="save" value="<%:Save%>" />
</div>
</form>

<%+footer%>
